
@{
    ViewData["Title"] = Serenity.LocalText.Get("Db.Northwind.Scales.EntitySingular");
}
@section Head {
    <script src="~/Scripts/flot/jquery.flot.js"></script>
    <script src="~/Scripts/adminlte/demo.js"></script>

}

@if (ViewBag.NoConnection == null)
{
    <div class="row">
        <div class="col-xs-12">
            <!-- interactive chart -->
            <div class="box box-primary">
                <div class="box-header with-border">
                    <i class="fa fa-bar-chart-o"></i>
                    <h3 class="box-title">Моментно състояние на кантара в реално време</h3>
                 
                </div>
                <div class="box-body">
                    <div id="interactive" style="height: 300px;"></div>
                </div><!-- /.box-body-->
            </div><!-- /.box -->
        </div><!-- /.col -->
    </div><!-- /.row -->
}
else
{
    <div class="row">
        <div class="col-xs-12">
            <div class="alert alert-danger alert-dismissable">
                <button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button>
                <h4><i class="icon fa fa-ban"></i> Внимание!</h4>
                Не може да бъде осъществена интернет връзка до кантара!
                
                    @*<br/>
                    <br/>
                    <div class="jumbotron">
                        Inner
                        error:
                        @ViewBag.NoConnection
                    </div>*@
                
            </div>
        </div>
    </div>
}



<div id="GridDiv" data-scaleid="@ViewBag.Scale"></div>

<script type="text/javascript">
 


    jQuery(function () {
        new FruitCorrect.Northwind.SavedScaleMasurementGrid($('#GridDiv'),{}).init();

        Q.initFullHeightGridPage($('#GridDiv'));
    });
    
    /*
     * Flot Interactive Chart
     * -----------------------
     */
    // We use an inline data source in the example, usually data would
    // be fetched from a server
    var data = [], totalPoints = 100;
    var options = {
        grid: {
            borderColor: "#f3f3f3",
            borderWidth: 1,
            tickColor: "#f3f3f3"
        },
        series: {
            shadowSize: 0, // Drawing is faster without shadows
            color: "#3c8dbc"
        },
        lines: {
            fill: true, //Converts the line chart to area chart
            color: "#3c8dbc"
        },
        yaxis: {
            min: 0,
            max: 100,
            show: true
        },
        xaxis: {
            show: false
        }
    };

        var interactive_plot = $.plot("#interactive", [data], options );
 
</script>
@if (ViewBag.NoConnection == null)
{
    @section BadScripts
    {
        <!--Reference the SignalR library. -->
        <script src="http://ajax.aspnetcdn.com/ajax/signalr/jquery.signalr-2.2.2.min.js"></script>

        <!--Reference the autogenerated SignalR hub script. -->
        <script src="http://localhost:8089/signalr/hubs"></script>
        <!--Add script to update the page and send messages.-->


        <script>

            var scalesHub = $.connection.scalesHub;
            $.connection.hub.url = 'http://localhost:8089/signalr';
            scalesHub.client.onMessageReceived = function(name, message) {
                var messageJson = $.parseJSON(message);

                if (data.length > 99) {
                    data.shift(); 
                }

                data.push(messageJson.Weight);

                var res = [];
                for (var i = 0; i < data.length; ++i) {
                    res.push([i, data[i]]);
                }

                $.plot("#interactive", [res], options);

            };

            $.connection.hub.start()
                .done(function() {


                    console.log('Now connected, connection ID=' + $.connection.hub.id);
                })
                .fail(function() {
                    console.log("Could not connect!");

                });

        </script>
    }
}